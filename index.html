<!DOCTYPE html>
<html>
<head>
  <title>Atidaryti Aplanką</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
window.TrelloPowerUp.initialize({
  'card-buttons': function(t) {
    return t.card('desc')
      .get('desc')
      .then(function(desc) {
        if (!desc) return [];

        const lines = desc.split('\n');
        const buttons = [];

        lines.forEach(line => {
          // Ieško eilučių pagal formatą: "Pavadinimas: open-folder://..."
          const match = line.match(/^(.+?):\s*`(open-folder:\/\/.+?)`$/i);
          if (match) {
            const label = match[1].trim(); // Pvz: Test1
            const folderUrlRaw = match[2].trim(); // Pvz: open-folder://AntiusDragon\Disk1
            const folderUrl = folderUrlRaw.replace(/\\/g, '/'); // Naršyklės suderinamumui

            buttons.push({
              icon: 'https://cdn-icons-png.flaticon.com/512/716/716784.png',
              text: label, // rodomas pavadinimas, pvz. "Test1"
              callback: function(t) {
                try {
                  window.location.href = folderUrl;
                } catch (err) {
                  console.error('Nepavyko atidaryti aplanko:', err);
                }
                return t.closePopup();
              }
            });
          }
        });

        return buttons;
      });
  }
});
</script>
</body>
</html>
