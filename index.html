<!DOCTYPE html>
<html>
<head>
  <title>Atidaryti Aplanką</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
window.TrelloPowerUp.initialize({
  'card-buttons': function(t) {
    return t.card('desc')
      .get('desc')
      .then(function(desc) {
        if (!desc) return [];

        const parser = new DOMParser();
        const doc = parser.parseFromString(desc, 'text/html');
        const codeBlocks = doc.querySelectorAll('code');

        const buttons = [];

        codeBlocks.forEach(code => {
          const text = code.textContent.trim();
          if (!text.startsWith('open-folder://')) return;

          const rawPath = text.replace(/\\/g, '/');

          // Ieškom prieš tai esančio <strong> kaip pavadinimo
          let label = 'Atidaryti aplanką';
          let previous = code.closest('p')?.previousElementSibling;

          while (previous) {
            const strong = previous.querySelector('strong');
            if (strong) {
              label = strong.textContent.trim().replace(/[:：]+$/, '');
              break;
            }
            previous = previous.previousElementSibling;
          }

          buttons.push({
            icon: 'https://cdn-icons-png.flaticon.com/512/716/716784.png',
            text: label,
            callback: function(t) {
              const iframe = document.createElement('iframe');
              iframe.style.display = 'none';
              iframe.src = `open-folder://${rawPath}`;
              document.body.appendChild(iframe);
              return t.closePopup();
            }
          });
        });

        return buttons;
      });
  }
});
</script>
</body>
</html>
