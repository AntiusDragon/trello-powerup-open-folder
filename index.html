<!DOCTYPE html>
<html>
<head>
  <title>Atidaryti Aplanką</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
window.TrelloPowerUp.initialize({
  'card-buttons': function(t) {
    return t.card('desc')
      .get('desc')
      .then(function(desc) {
        if (!desc) return [];

        // Paimam visus blokus: galimas pavadinimas + open-folder nuoroda
        const regex = /(?:^|\n)(.*?):?\s*\n?open-folder:\/\/([^\s`]+)/g;
        let match;
        const buttons = [];

        while ((match = regex.exec(desc)) !== null) {
          let title = match[1].trim();
          const rawPath = match[2];

          // Jei pavadinimas panašus į patį path (ar tuščias), naudoti numatytąjį
          if (!title || rawPath.includes(title)) {
            title = 'Atidaryti aplanką';
          }

          const sanitizedLink = 'open-folder://' + rawPath.replace(/\\/g, '/');

          buttons.push({
            icon: 'https://cdn-icons-png.flaticon.com/512/716/716784.png',
            text: title,
            callback: function(t) {
              const iframe = document.createElement('iframe');
              iframe.style.display = 'none';
              iframe.src = sanitizedLink;
              document.body.appendChild(iframe);
              return t.closePopup();
            }
          });
        }

        return buttons;
      });
  }
});
</script>
</body>
</html>
